
开发板使用的是正点原子的 STM32F767IGT6, 显示屏使用的是 16bit 的 TFTLCD 显示屏

## TFT-LCD

TFT-LCD, 薄膜晶体管液晶显示器, Thin Film Transistor-Liquid Crystal Display

8080接口, 有8位数据总线和16位数据总线, 这里是16位数据总线

    CS: TFTLCD 片选信号
    WR: 向 TFTLCD 写入数据
    RD: 从 TFTLCD 读取数据
    D[15: 0]: 16 位双向数据线
    RST: 硬复位 TFTLCD
    RS: 命令/数据标志(0, 读写命令；1, 读写数据)

读写过程:

    先根据写入/读取的数据的类型, 设置DC为 高(数据)/低(命令), 再拉低片选
    若为读 --> 设置 RD 为低, 若为写 --> 设置 WR 为低
    读: 在RD的上升沿, 将数据锁存到数据线(D[15: 0])上
    写: 在WR的上升沿, 将数据写入到目标设备上

![](images/8080%E5%B9%B6%E5%8F%A3-%E5%86%99%E6%97%B6%E5%BA%8F.png)

![](images/8080%E5%B9%B6%E5%8F%A3-%E8%AF%BB%E6%97%B6%E5%BA%8F.png)

![](images/8080%E5%B9%B6%E5%8F%A3-%E6%8E%A7%E5%88%B6%E8%84%9A%E4%BF%A1%E5%8F%B7%E7%8A%B6%E6%80%81.png)

![](images/8080%E5%B9%B6%E5%8F%A3-%E8%AF%BB%E6%98%BE%E5%AD%98%E6%97%B6%E5%BA%8F.png)

## FMC 接口

通过 FMC接口, 把 TFT-LCD 当做 SRAM 内存 使用

FMC接口 将外部存储器划分为 6 个固定大小为 256M 字节的存储区域

![](images/FMC-%E5%A4%96%E9%83%A8%E5%AD%98%E5%82%A8%E5%99%A8%E5%8C%BA%E5%9F%9F%E5%88%92%E5%88%86.png)

总共 1.5GB 空间, 有6个存储块(Bank), TFT-LCD使用的是 存储区域1 (Bank1)

Bank1又被分成了4个区, 每个区管理64M字节的空间, 每个区都有独立的寄存器对所连接的存储器进行配置. Bank1的256M字节空间由28根地址线(HADDR[27:0])寻址.

![](images/Bank1%E5%AD%98%E5%82%A8%E5%8C%BA%E9%80%89%E6%8B%A9%E8%A1%A8.png)
这里 HADDR 是内部AHB地址总线, 其中 HADDR[25:0]是来自外部存储器地址FMC_A[25:0]

HADDR为字节地址, 而存储器是按字寻址, 所以存储器数据宽度不同, 实际上向存储器发送的地址也有所不同

![](images/FMC-BANK1-%E5%A4%96%E9%83%A8%E5%AD%98%E5%82%A8%E5%99%A8%E5%9C%B0%E5%9D%80.png)

因此, FMC 内部 HADDR 与存储器寻址地址的实际对应关系就是:
当接的是 32 位宽度存储器的时候: HADDR[25:2]→FMC_A [23:0]
当接的是 16 位宽度存储器的时候: HADDR[25:1]→FMC_A [24:0]
当接的是 8 位宽度存储器的时候: HADDR[25:0]→FMC_A [25:0]

不管是8/16/32位宽的设备, FMC_A[0]都接在外部设备地址A[0]上

![](images/FMC%E5%90%84Bank%E9%85%8D%E7%BD%AE%E5%AF%84%E5%AD%98%E5%99%A8%E8%A1%A8.png)

![](images/FMC-%E6%97%B6%E5%BA%8F%E6%A8%A1%E5%9E%8B.png)

FMC主要的时间参数

    HCLK的周期是1/216MHz ≈ 4.6ns

    地址建立时间(ADDSET)
        这里相当于 RD 高电平持续时间, 为 ADDSET 个 4.6ns

    数据建立时间(DATAST)
        这里相当于 RD 低电平持续时间, 为 DATAST 个 4.6ns

![](images/LCD%E6%97%B6%E9%97%B4%E5%8F%82%E6%95%B0.png)

FMC_BCRx(x=1~4) 控制寄存器

    EXTMOD, 扩展模式使能位, 是否允许读写不同的时序
    WREN, 写使能位
    MWID[1:0], 存储器数据总线宽度, 00 -> 8, 01 -> 16, 10 -> 32

## 硬件连接

### TFT-LCD

device id: 0X9488

LCD_BL(背光控制)对应 PB5
LCD_CS 对应 PD7 即 FMC_NE1
LCD_RS 对应 PD13 即 FMC_A18
LCD_WR 对应 PD5 即 FMC_NWE
LCD_RD 对应 PD4 即 FMC_NOE
LCD_D[15:0]则直接连接在 FMC_D15~FMC_D0


### XPT2046

    PENIRQ_N:
        笔触中断信号，当设置了笔触中断信号有效时，每当触摸屏被按下，该引脚被拉为低电平。当主控检测到该信号后，可以通过发控制信号来禁止笔触中断，从而避免在转换过程中误触发控制器中断。该引脚内部连接了一个50K的上拉电阻。

    CS_N:
        芯片选中信号，当CS_N被拉低时，用来控制转换时序并使能串行输入/输出寄存器以移出或移入数据。当该引脚为高电平时，芯片（ADC）进入掉电模式。

    DCLK:
        外部时钟输入，该时钟用来驱动SARADC的转换进程并驱动数字IO上的串行数据传输。

    DIN:
        芯片的数据串行输入脚，当CS为低电平时，数据在串行时钟DCLK的上升沿被锁存到片上的寄存器。

    DOUT:
        串行数据输出，在串行时钟DCLK的下降沿数据从此引脚上移出，当CS_N引脚为高电平时，该引脚为高阻态。

    BUSY:
        忙输出信号，当芯片接收完命令并开始转换时，该引脚产生一个DCLK周期的高电平。当该引脚由高点平变为低电平的时刻，转换结果的最高位数据呈现在DOUT引脚上，主控可以读取DOUT的值。当CS_N引脚为高电平时，BUSY引脚为高阻态。

